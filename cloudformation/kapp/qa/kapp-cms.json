{
    "Resources": {
        "WebsiteBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": "kapp-cms-frontend-qa",
                "CorsConfiguration": {
                    "CorsRules": [
                        {
                            "AllowedHeaders": [
                                "Authorization"
                            ],
                            "AllowedMethods": [
                                "GET",
                                "HEAD"
                            ],
                            "AllowedOrigins": [
                                "*"
                            ],
                            "MaxAge": 3000
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "CMS-frontend-website-s3-QA"
                    },
                    {
                        "Key": "ProjectCode",
                        "Value": "CMS"
                    },
                    {
                        "Key": "SupportContact",
                        "Value": "Stratpoint"
                    }
                ],
                "VersioningConfiguration": {
                    "Status": "Suspended"
                },
                "WebsiteConfiguration": {
                    "ErrorDocument": "index.html",
                    "IndexDocument": "index.html"
                },
                "AccessControl": "Private",
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "PublicAccessBlockConfiguration": {
                  "BlockPublicAcls" : false,
                  "IgnorePublicAcls" : true,
                  "BlockPublicPolicy" : false,
                  "RestrictPublicBuckets" : true
                }
                
            }
        },
        "AttachmentBucket": {
            "Type": "AWS::S3::Bucket",
            "Properties": {
                "BucketName": "kapp-cms-attachments-qa",
                "CorsConfiguration": {
                    "CorsRules": [
                        {
                            "AllowedHeaders": [
                                "Authorization"
                            ],
                            "AllowedMethods": [
                                "GET",
                                "HEAD"
                            ],
                            "AllowedOrigins": [
                                "*"
                            ],
                            "MaxAge": 3000
                        }
                    ]
                },
                "Tags": [
                    {
                        "Key": "Name",
                        "Value": "CMS-frontend-website-s3-QA"
                    },
                    {
                        "Key": "ProjectCode",
                        "Value": "CMS"
                    },
                    {
                        "Key": "SupportContact",
                        "Value": "Stratpoint"
                    }
                ],
                "VersioningConfiguration": {
                    "Status": "Suspended"
                },
                "WebsiteConfiguration": {
                    "ErrorDocument": "index.html",
                    "IndexDocument": "index.html"
                },
                "AccessControl": "Public",
                "BucketEncryption": {
                    "ServerSideEncryptionConfiguration": [
                        {
                            "ServerSideEncryptionByDefault": {
                                "SSEAlgorithm": "AES256"
                            }
                        }
                    ]
                },
                "PublicAccessBlockConfiguration": {
                  "BlockPublicAcls" : false,
                  "IgnorePublicAcls" : false,
                  "BlockPublicPolicy" : false,
                  "RestrictPublicBuckets" : false
                }
                
            }
        },
        "WebsiteCloudfront":
        {
            "Type": "AWS::CloudFront::Distribution",
            "DependsOn": ["WebsiteBucket"],
            "Properties": {
              "DistributionConfig": {
                  "Comment": "Cloudfront Distribution pointing to S3 bucket",
                  "Origins": [
                        {
                          "CustomOriginConfig" : {
                            "HTTPPort" : "80",
                            "HTTPSPort" : "443",
                            "OriginProtocolPolicy" : "http-only",
                          },
                          "DomainName" : {
                            "Fn::Select" : [ 2, {
                                "Fn::Split" : [ "/", {
                                    "Fn::GetAtt" : [ "WebsiteBucket", "WebsiteURL" ]
                                }] 
                            } ]
                          },
                          "Id" : "S3Origin"
                        }
                ],
                "Enabled": true,
                "HttpVersion": "http2",
                "DefaultRootObject": "index.html",
                "DefaultCacheBehavior":
                {
                    "AllowedMethods" : [ "GET", "HEAD" ],
                    "Compress" : true,
                    "ForwardedValues" : {
                        "QueryString": true,
                        "Cookies": {
                            "Forward": "none"
                        }
                    },
                    "TargetOriginId" : "S3Origin",
                    "ViewerProtocolPolicy" : "redirect-to-https",
                  },

                  "PriceClass": "PriceClass_All"
              },
              "Tags" : [
                {
                    "Key": "Name",
                    "Value": "CMS-Website-Cloudfront-QA"
                },
                {
                    "Key": "ProjectCode",
                    "Value": "CMS"
                },
                {
                    "Key": "SupportContact",
                    "Value": "Stratpoint"
                }
            ]
            }
        },
        "CMSDatabase":
        {
            "Type" : "AWS::RDS::DBCluster",
            "Properties" : {
                "AssociatedRoles" : [ DBClusterRole, ... ],
                "AvailabilityZones" : [ String, ... ],
                "BacktrackWindow" : Long,
                "BackupRetentionPeriod" : Integer,
                "DatabaseName" : String,
                "DBClusterIdentifier" : String,
                "DBClusterParameterGroupName" : String,
                "DBSubnetGroupName" : String,
                "DeletionProtection" : Boolean,
                "EnableCloudwatchLogsExports" : [ String, ... ],
                "EnableHttpEndpoint" : Boolean,
                "EnableIAMDatabaseAuthentication" : Boolean,
                "Engine" : String,
                "EngineMode" : String,
                "EngineVersion" : String,
                "KmsKeyId" : String,
                "MasterUsername" : String,
                "MasterUserPassword" : String,
                "Port" : Integer,
                "PreferredBackupWindow" : String,
                "PreferredMaintenanceWindow" : String,
                "ReplicationSourceIdentifier" : String,
                "RestoreType" : String,
                "ScalingConfiguration" : ScalingConfiguration,
                "SnapshotIdentifier" : String,
                "SourceDBClusterIdentifier" : String,
                "SourceRegion" : String,
                "StorageEncrypted" : Boolean,
                "Tags" : [ Tag, ... ],
                "UseLatestRestorableTime" : Boolean,
                "VpcSecurityGroupIds" : [ String, ... ]
              }
          }
    }
}
  